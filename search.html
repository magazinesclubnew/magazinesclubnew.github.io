---
layout: default
title: 搜索
permalink: /search/
---
<div class="search-page">
  <h1 class="sr-only">搜索文章</h1>
  <div class="search-container">
    <input type="text" id="search-input" class="search-input" placeholder="搜索文章..." autocomplete="off" autofocus>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

<script>
(function() {
  const posts = [
    {% for post in site.posts %}
    {
      title: {{ post.title | jsonify }},
      subtitle: {{ post.subtitle | jsonify }},
      url: {{ post.url | relative_url | jsonify }},
      date: {{ post.date | date: "%Y.%m.%d" | jsonify }},
      content: {{ post.content | strip_html | truncatewords: 100 | jsonify }},
      tags: {{ post.tags | jsonify }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  function search(query) {
    if (!query || query.length < 2) {
      searchResults.innerHTML = '<p class="search-hint">输入至少2个字符开始搜索</p>';
      return;
    }

    const q = query.toLowerCase();
    const results = posts.filter(post => {
      return (post.title && post.title.toLowerCase().includes(q)) ||
             (post.subtitle && post.subtitle.toLowerCase().includes(q)) ||
             (post.content && post.content.toLowerCase().includes(q)) ||
             (post.tags && post.tags.some(tag => tag.toLowerCase().includes(q)));
    });

    if (results.length === 0) {
      searchResults.innerHTML = '<p class="search-no-results">没有找到相关文章</p>';
      return;
    }

    searchResults.innerHTML = results.map(post => `
      <a href="${post.url}" class="search-result-item">
        <span class="search-result-date">${post.date}</span>
        <span class="search-result-title">${post.title}</span>
        ${post.subtitle ? `<span class="search-result-subtitle">${post.subtitle}</span>` : ''}
      </a>
    `).join('');
  }

  let debounceTimer;
  searchInput.addEventListener('input', (e) => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => search(e.target.value), 200);
  });

  // Initial state
  search('');
})();
</script>
